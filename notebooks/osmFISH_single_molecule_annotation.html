<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Single molecule data: osmFISH mouse somato-sensory cortex &mdash; TACCO  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=ad0ac74c" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
      <link rel="stylesheet" type="text/css" href="../_static/readthedocs-custom.css?v=c8300288" />
      <link rel="stylesheet" type="text/css" href="../_static/notebook_hacks.css?v=e4ce2130" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TACCO overview" href="overview.html" />
    <link rel="prev" title="Object splitting for in-silico mixed scRNA-seq data and Slide-Seq data" href="object_splitting.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="benchmarking.html">Benchmarking runtime and memory of annotation methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="cooccurrence.html">Co-occurrence computations</a></li>
<li class="toctree-l2"><a class="reference internal" href="insilico_mouse_colon.html">In-silico mixed Mouse Colon scRNA-seq data</a></li>
<li class="toctree-l2"><a class="reference internal" href="mapping_single_cells_into_space.html">Mapping single cells into space</a></li>
<li class="toctree-l2"><a class="reference internal" href="object_splitting.html">Object splitting for in-silico mixed scRNA-seq data and Slide-Seq data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Single molecule data: osmFISH mouse somato-sensory cortex</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Load-data">Load data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Plotting-options">Plotting options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Analysis-options">Analysis options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Spatial-overview">Spatial overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Analysis-on-the-cell-like-level">Analysis on the cell-like level</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Get-an-impression-of-the-stability-of-TACCO's-single-molecule-annotation-wrt-changes-in-its-configuration">Get an impression of the stability of TACCO’s single molecule annotation wrt changes in its configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">TACCO overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameter_variations.html">Parameter Variations for annotation using Optimal Transport</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulated_ambient.html">Simulated single cell expression data with ambient contamination</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulated_dropout.html">Simulated single cell expression data with dropout</a></li>
<li class="toctree-l2"><a class="reference internal" href="single_cell_differentiation.html">Single-cell differentiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="slideseq_mouse_colon.html">Slide-Seq Mouse Colon</a></li>
<li class="toctree-l2"><a class="reference internal" href="slideseq_mouse_olfactory_bulb.html">Slide-Seq Mouse Olfactory Bulb - multiple pucks</a></li>
<li class="toctree-l2"><a class="reference internal" href="slideseq_mouse_olfactory_bulb_single.html">Slide-Seq Mouse Olfactory Bulb - single puck</a></li>
<li class="toctree-l2"><a class="reference internal" href="visium_mouse_kidney.html">Visium Mouse Kidney</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/tacco.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TACCO</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../examples.html">Examples</a></li>
      <li class="breadcrumb-item active">Single molecule data: osmFISH mouse somato-sensory cortex</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Single-molecule-data:-osmFISH-mouse-somato-sensory-cortex">
<h1>Single molecule data: osmFISH mouse somato-sensory cortex<a class="headerlink" href="#Single-molecule-data:-osmFISH-mouse-somato-sensory-cortex" title="Link to this heading">¶</a></h1>
<p>This example uses TACCO to annotate and analyse mouse somato-sensory cortex osmFISH data (Codeluppi et al.) and compares it to the results from Baysor (Petukhov et al.) and SSAM (Park et al.).</p>
<p>(Codeluppi et al.): Simone Codeluppi, Lars E. Borm, Amit Zeisel, Gioele La Manno, Josina A. van Lunteren, Camilla I. Svensson &amp; Sten Linnarsson. Spatial organization of the somatosensory cortex revealed by osmFISH. Nat Methods 15, 932–935 (2018). <a class="reference external" href="https://doi.org/10.1038/s41592-018-0175-z">https://doi.org/10.1038/s41592-018-0175-z</a></p>
<p>(Petukhov et al.): Petukhov V, Xu RJ, Soldatov RA, Cadinu P, Khodosevich K, Moffitt JR &amp; Kharchenko PV. Cell segmentation in imaging-based spatial transcriptomics. Nat Biotechnol 40, 345–354 (2022). <a class="reference external" href="https://doi.org/10.1038/s41587-021-01044-w">https://doi.org/10.1038/s41587-021-01044-w</a></p>
<p>(Park et al.): Jeongbin Park, Wonyl Choi, Sebastian Tiesmeyer, Brian Long, Lars E. Borm, Emma Garren, Thuc Nghi Nguyen, Bosiljka Tasic, Simone Codeluppi, Tobias Graf, Matthias Schlesner, Oliver Stegle, Roland Eils &amp; Naveed Ishaque. Cell segmentation-free inference of cell types from in situ transcriptomics data. Nat Commun 12, 3545 (2021). <a class="reference external" href="https://doi.org/10.1038/s41467-021-23807-4">https://doi.org/10.1038/s41467-021-23807-4</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">anndata</span> <span class="k">as</span> <span class="nn">ad</span>
<span class="kn">import</span> <span class="nn">scanpy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">sklearn.metrics</span>

<span class="kn">import</span> <span class="nn">tacco</span> <span class="k">as</span> <span class="nn">tc</span>

<span class="c1"># The notebook expects to be executed either in the workflow directory or in the repository root folder...</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;workflow&#39;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;workflow/common_code.py&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;..&#39;</span><span class="p">))</span>
<span class="kn">import</span> <span class="nn">common_code</span>
</pre></div>
</div>
</div>
<section id="Load-data">
<h2>Load data<a class="headerlink" href="#Load-data" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="n">common_code</span><span class="o">.</span><span class="n">find_path</span><span class="p">(</span><span class="s1">&#39;results/osmFISH&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/data/reference.h5ad&#39;</span><span class="p">)</span>
<span class="n">rna_coords</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/full_anno.csv.gz&#39;</span><span class="p">)</span>
<span class="n">rna_coords</span><span class="p">[</span><span class="s1">&#39;ClusterName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rna_coords</span><span class="p">[</span><span class="s1">&#39;ClusterName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Plotting-options">
<h2>Plotting options<a class="headerlink" href="#Plotting-options" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">highres</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">default_dpi</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="k">if</span> <span class="n">highres</span><span class="p">:</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">648.0</span>
    <span class="n">hr_ext</span> <span class="o">=</span> <span class="s1">&#39;_hd&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_dpi</span>
    <span class="n">hr_ext</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="n">axsize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Inhibitory CP&#39;</span><span class="p">:</span> <span class="s1">&#39;#982581&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Inhibitory Crhbp&#39;</span><span class="p">:</span> <span class="s1">&#39;#83469b&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Inhibitory Cnr1&#39;</span><span class="p">:</span><span class="s1">&#39;#cb467c&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Inhibitory IC&#39;</span><span class="p">:</span> <span class="s1">&#39;#ee519f&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Inhibitory Kcnip2&#39;</span><span class="p">:</span> <span class="s1">&#39;#9681bd&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Inhibitory Pthlh&#39;</span><span class="p">:</span> <span class="s1">&#39;#533594&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Inhibitory Vip&#39;</span><span class="p">:</span><span class="s1">&#39;#765aa6&#39;</span><span class="p">,</span>

             <span class="s1">&#39;Pyramidal Cpne5&#39;</span><span class="p">:</span><span class="s1">&#39;#3a449b&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Pyramidal L2-3&#39;</span><span class="p">:</span> <span class="s1">&#39;#10b6e7&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Pyramidal L2-3 L5&#39;</span><span class="p">:</span><span class="s1">&#39;#1f6a89&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Pyramidal Kcnip2&#39;</span><span class="p">:</span><span class="s1">&#39;#6988c4&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Pyramidal L3-4&#39;</span><span class="p">:</span> <span class="s1">&#39;#2255a6&#39;</span><span class="p">,</span>
             <span class="s1">&#39;pyramidal L4&#39;</span><span class="p">:</span> <span class="s1">&#39;#8ad7ef&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Pyramidal L5&#39;</span><span class="p">:</span> <span class="s1">&#39;#18a0b5&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Pyramidal L6&#39;</span><span class="p">:</span><span class="s1">&#39;#1980c4&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Hippocampus&#39;</span><span class="p">:</span> <span class="s1">&#39;#094d73&#39;</span><span class="p">,</span>

             <span class="s1">&#39;Astrocyte Gfap&#39;</span><span class="p">:</span> <span class="s1">&#39;#dd4827&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Astrocyte Mfge8&#39;</span><span class="p">:</span> <span class="s1">&#39;#f5914b&#39;</span><span class="p">,</span>

             <span class="s1">&#39;Oligodendrocyte Precursor cells&#39;</span><span class="p">:</span> <span class="s1">&#39;#b7d541&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Oligodendrocyte COP&#39;</span><span class="p">:</span> <span class="s1">&#39;#6dbe45&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Oligodendrocyte NF&#39;</span><span class="p">:</span> <span class="s1">&#39;#62a64e&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Oligodendrocyte MF&#39;</span><span class="p">:</span><span class="s1">&#39;#2d744b&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Oligodendrocyte Mature&#39;</span><span class="p">:</span> <span class="s1">&#39;#27562b&#39;</span><span class="p">,</span>

             <span class="s1">&#39;Perivascular Macrophages&#39;</span><span class="p">:</span><span class="s1">&#39;#752b17&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Microglia&#39;</span><span class="p">:</span><span class="s1">&#39;#a7633e&#39;</span><span class="p">,</span>

             <span class="s1">&#39;C. Plexus&#39;</span><span class="p">:</span> <span class="s1">&#39;#21b284&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Ependymal&#39;</span><span class="p">:</span><span class="s1">&#39;#f6e10b&#39;</span><span class="p">,</span>

             <span class="s1">&#39;Pericytes&#39;</span><span class="p">:</span><span class="s1">&#39;#fac696&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Endothelial&#39;</span><span class="p">:</span><span class="s1">&#39;#ed2426&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Endothelial 1&#39;</span><span class="p">:</span><span class="s1">&#39;#f05658&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Vascular Smooth Muscle&#39;</span><span class="p">:</span><span class="s1">&#39;#adc471&#39;</span><span class="p">,</span>

             <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="s1">&#39;#D3D3D3&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="Analysis-options">
<h2>Analysis options<a class="headerlink" href="#Analysis-options" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">method_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tacco&#39;</span><span class="p">,</span><span class="s1">&#39;baysor&#39;</span><span class="p">,</span><span class="s1">&#39;ssam&#39;</span><span class="p">]</span>
<span class="n">method_props</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;ClusterName&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;osmFISH-recovered cells&#39;</span><span class="p">,</span><span class="s1">&#39;single molecule annotations from mapping back the published Watershed-segmentation based annotations&#39;</span><span class="p">,</span> <span class="s1">&#39;osmFISH-recovered cells&#39;</span><span class="p">,],</span>
    <span class="s1">&#39;tacco&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;TACCO&#39;</span><span class="p">,</span> <span class="s1">&#39;single molecule annotations without segmentation&#39;</span><span class="p">,</span> <span class="s1">&#39;TACCO sm annotation&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="s1">&#39;baysor&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Baysor&#39;</span><span class="p">,</span> <span class="s1">&#39;single molecule annotations without segmentation&#39;</span><span class="p">,</span> <span class="s1">&#39;Baysor sm annotation&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="s1">&#39;ssam&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;SSAM&#39;</span><span class="p">,</span> <span class="s1">&#39;single molecule annotations from mapping back pixel-based annotations&#39;</span><span class="p">,</span> <span class="s1">&#39;SSAM sm annotation&#39;</span><span class="p">,</span> <span class="p">],</span>
<span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nice_name&#39;</span><span class="p">,</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</section>
<section id="Spatial-overview">
<h2>Spatial overview<a class="headerlink" href="#Spatial-overview" title="Link to this heading">¶</a></h2>
<p>Plot the single-molecule annotations for different methods to get a general overview</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rna_coords</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ClusterName&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">method_keys</span><span class="p">],</span> <span class="n">axsize</span><span class="o">=</span><span class="mf">4e-3</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">noticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">point_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">method_labels</span><span class="o">=</span><span class="n">method_props</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_13_0.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_13_0.png" />
</div>
</div>
<p>Zoom in to see the single molecules</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span> <span class="o">=</span> <span class="mi">1150</span><span class="p">,</span><span class="mi">1400</span>
<span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span><span class="mi">1600</span> <span class="c1">#1170,1690</span>
<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;x &gt; @xmin &amp; x &lt; @xmax &amp; y &gt; @ymin &amp; y &lt; @ymax&#39;</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rna_coords</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ClusterName&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">method_keys</span><span class="p">],</span> <span class="n">axsize</span><span class="o">=</span><span class="mf">2e-2</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">noticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">method_labels</span><span class="o">=</span><span class="n">method_props</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_15_0.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_15_0.png" />
</div>
</div>
<p>Plotting astrocyte markers</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">astro_gene_colors</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;Gfap&#39;</span><span class="p">:</span> <span class="s1">&#39;#dd4827&#39;</span><span class="p">,</span> <span class="s1">&#39;Mfge8&#39;</span><span class="p">:</span> <span class="s1">&#39;#f5914b&#39;</span><span class="p">,</span> <span class="s1">&#39;Aldoc&#39;</span><span class="p">:</span> <span class="s1">&#39;#DE7C5A&#39;</span><span class="p">,</span> <span class="s1">&#39;Serpinf1&#39;</span><span class="p">:</span> <span class="s1">&#39;#280000&#39;</span> <span class="p">}</span>
<span class="n">astro_genes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">astro_gene_colors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">genes</span> <span class="o">=</span> <span class="n">rna_coords</span><span class="p">[</span><span class="s1">&#39;gene&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">gene_color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="p">:</span><span class="s1">&#39;#D3D3D3&#39;</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">genes</span><span class="p">}</span>
<span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="n">astro_gene_colors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">gene_color_dict</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rna_coords</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">keys</span><span class="o">=</span><span class="s1">&#39;gene&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">gene_color_dict</span><span class="p">,</span> <span class="n">axsize</span><span class="o">=</span><span class="mf">2e-2</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
<span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Astrocyte marker genes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Astrocyte marker genes&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_17_1.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_17_1.png" />
</div>
</div>
</section>
<section id="Analysis-on-the-cell-like-level">
<h2>Analysis on the cell-like level<a class="headerlink" href="#Analysis-on-the-cell-like-level" title="Link to this heading">¶</a></h2>
<p>Process the segmented data using the recipe given in (Codeluppi et al.)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prep_codeluppi</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">min_counts</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span><span class="n">tc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">X</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">min_counts</span><span class="p">]</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">AnnData</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span><span class="n">obs</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="n">obsm</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">)</span>
    <span class="n">sums0</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">X</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sums1</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">X</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tc</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">col_scale</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">sums0</span><span class="p">)</span>
    <span class="n">tc</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">row_scale</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">sums1</span><span class="p">)</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">X</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">tsne</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adata</span>

<span class="k">def</span> <span class="nf">construct_segmented_data</span><span class="p">(</span><span class="n">seg_col</span><span class="p">,</span> <span class="n">ann_col</span><span class="p">):</span>
    <span class="n">count_data</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">dataframe2anndata</span><span class="p">(</span><span class="n">rna_coords</span><span class="p">,</span> <span class="n">obs_key</span><span class="o">=</span><span class="n">seg_col</span><span class="p">,</span> <span class="n">var_key</span><span class="o">=</span><span class="s1">&#39;gene&#39;</span><span class="p">,</span> <span class="n">compositional_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ClusterName&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">method_keys</span><span class="p">],</span> <span class="n">mean_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
    <span class="c1"># by construction of the TACCO segmentation, only cells composed of molecules typed with a single type are reconstructed</span>
    <span class="c1"># assert(((count_data.obsm[ann_col].to_numpy().flatten()==0)|(count_data.obsm[ann_col].to_numpy().flatten()==1)).all())</span>
    <span class="c1"># for the Baysor segmentation this is not exactly the case</span>
    <span class="n">tc</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_maximum_annotation</span><span class="p">(</span><span class="n">count_data</span><span class="p">,</span> <span class="n">ann_col</span><span class="p">,</span> <span class="n">ann_col</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">count_data</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="n">ann_col</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">count_data</span>

<span class="n">segmented_min_counts</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">seg_props</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">[</span> <span class="s1">&#39;TonT&#39;</span><span class="p">,</span> <span class="s1">&#39;TACCO segmentation</span><span class="se">\n</span><span class="s1">on TACCO annotation&#39;</span><span class="p">,</span> <span class="s1">&#39;tacco_seg&#39;</span><span class="p">,</span> <span class="s1">&#39;tacco&#39;</span><span class="p">,</span> <span class="s1">&#39;TACCO segmentation&#39;</span><span class="p">,</span> <span class="s1">&#39;TACCO&#39;</span><span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;TonB&#39;</span><span class="p">,</span> <span class="s1">&#39;TACCO segmentation</span><span class="se">\n</span><span class="s1">on Baysor annotation&#39;</span><span class="p">,</span> <span class="s1">&#39;baysor_seg&#39;</span><span class="p">,</span> <span class="s1">&#39;baysor&#39;</span><span class="p">,</span> <span class="s1">&#39;TACCO segmentation&#39;</span><span class="p">,</span> <span class="s1">&#39;Baysor&#39;</span><span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;TonS&#39;</span><span class="p">,</span> <span class="s1">&#39;TACCO segmentation</span><span class="se">\n</span><span class="s1">on SSAM annotation&#39;</span><span class="p">,</span> <span class="s1">&#39;ssam_seg&#39;</span><span class="p">,</span> <span class="s1">&#39;ssam&#39;</span><span class="p">,</span> <span class="s1">&#39;TACCO segmentation&#39;</span><span class="p">,</span> <span class="s1">&#39;SSAM&#39;</span><span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;BonB&#39;</span><span class="p">,</span> <span class="s1">&#39;Baysor segmentation</span><span class="se">\n</span><span class="s1">on Baysor annotation&#39;</span><span class="p">,</span> <span class="s1">&#39;baysor_beg&#39;</span><span class="p">,</span> <span class="s1">&#39;baysor&#39;</span><span class="p">,</span> <span class="s1">&#39;Baysor segmentation&#39;</span><span class="p">,</span> <span class="s1">&#39;Baysor</span><span class="se">\n</span><span class="s1">[using Baysor segmentation]&#39;</span><span class="p">],</span>
<span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span><span class="s1">&#39;nice_name&#39;</span><span class="p">,</span><span class="s1">&#39;seg_col&#39;</span><span class="p">,</span><span class="s1">&#39;ann_col&#39;</span><span class="p">,</span><span class="s1">&#39;nice_seg&#39;</span><span class="p">,</span><span class="s1">&#39;nice_ann&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
<span class="n">seg_datas</span> <span class="o">=</span> <span class="p">{</span> <span class="n">key</span><span class="p">:</span> <span class="n">construct_segmented_data</span><span class="p">(</span><span class="n">seg_col</span><span class="p">,</span> <span class="n">ann_col</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">seg_col</span><span class="p">,</span><span class="n">ann_col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">seg_props</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">seg_props</span><span class="p">[</span><span class="s1">&#39;seg_col&#39;</span><span class="p">],</span><span class="n">seg_props</span><span class="p">[</span><span class="s1">&#39;ann_col&#39;</span><span class="p">])</span> <span class="p">}</span>

<span class="n">norm_datas</span> <span class="o">=</span> <span class="p">{</span> <span class="n">key</span><span class="p">:</span> <span class="n">prep_codeluppi</span><span class="p">(</span><span class="n">seg_data</span><span class="p">,</span> <span class="n">segmented_min_counts</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">seg_data</span> <span class="ow">in</span> <span class="n">seg_datas</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>
<span class="n">norm_datas</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prep_codeluppi</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">segmented_min_counts</span><span class="p">)</span>

<span class="n">ext_seg_props</span> <span class="o">=</span> <span class="n">seg_props</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ext_seg_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nice_name&#39;</span><span class="p">:</span><span class="s1">&#39;osmFISH-recovered cells&#39;</span><span class="p">,</span><span class="s1">&#39;seg_col&#39;</span><span class="p">:</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span><span class="s1">&#39;ann_col&#39;</span><span class="p">:</span><span class="s1">&#39;ClusterName&#39;</span><span class="p">,</span><span class="s1">&#39;nice_seg&#39;</span><span class="p">:</span><span class="s1">&#39;osmFISH-recovered cells&#39;</span><span class="p">,</span><span class="s1">&#39;nice_ann&#39;</span><span class="p">:</span><span class="s1">&#39;osmFISH-recovered cells&#39;</span><span class="p">}</span>
<span class="n">ext_seg_props</span> <span class="o">=</span> <span class="n">ext_seg_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">ext_seg_props</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="o">*</span><span class="n">ext_seg_props</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],]]</span>
<span class="n">seg_datas</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reference</span>
</pre></div>
</div>
</div>
<p>Compare the TACCO segmentation to the watershed segmentation results from (Codeluppi et al.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">axs</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">axsize</span><span class="o">=</span><span class="p">(</span><span class="mf">1.9</span><span class="p">,</span><span class="mf">1.9</span><span class="p">),</span> <span class="n">x_padding</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">norm_datas</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">],</span><span class="s1">&#39;ClusterName&#39;</span><span class="p">,</span> <span class="n">position_key</span><span class="o">=</span><span class="s1">&#39;X_tsne&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">noticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">axes_labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tSNE 0&#39;</span><span class="p">,</span><span class="s1">&#39;tSNE 1&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="p">);</span>
<span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">norm_datas</span><span class="p">[</span><span class="s1">&#39;TonT&#39;</span><span class="p">],</span>     <span class="s1">&#39;tacco&#39;</span><span class="p">,</span>       <span class="n">position_key</span><span class="o">=</span><span class="s1">&#39;X_tsne&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">noticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">axes_labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tSNE 0&#39;</span><span class="p">,</span><span class="s1">&#39;tSNE 1&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="p">);</span>
<span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">norm_datas</span><span class="p">[</span><span class="s1">&#39;TonT&#39;</span><span class="p">],</span>     <span class="s1">&#39;ClusterName&#39;</span><span class="p">,</span> <span class="n">position_key</span><span class="o">=</span><span class="s1">&#39;X_tsne&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">noticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">axes_labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tSNE 0&#39;</span><span class="p">,</span><span class="s1">&#39;tSNE 1&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;osmFISH recovered cells&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;TACCO segmentation&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;with osmFISH annotation&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;with osmFISH annotation&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_22_1.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_22_1.png" />
</div>
</div>
<p>Cross-comparison of annotations of different methods with combinations of segmentation methods and annotations used in the segmentation</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">axs</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">method_keys</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">seg_props</span><span class="p">),</span> <span class="n">axsize</span><span class="o">=</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span> <span class="n">x_padding</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y_padding</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i_data</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seg_props</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j_method</span><span class="p">,</span><span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">method_keys</span><span class="p">):</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">norm_datas</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">method</span><span class="p">,</span>    <span class="n">position_key</span><span class="o">=</span><span class="s1">&#39;X_tsne&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">noticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">axes_labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tSNE 0&#39;</span><span class="p">,</span><span class="s1">&#39;tSNE 1&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i_data</span><span class="p">,</span><span class="n">j_method</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="p">((</span><span class="n">i_data</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j_method</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">method_keys</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="p">);</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i_data</span><span class="p">,</span><span class="n">j_method</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">method_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">method</span><span class="p">,</span><span class="s2">&quot;nice_name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> annotation&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i_data</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">seg_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s2">&quot;nice_name&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i_data</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_24_0.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_24_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">axs</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="n">axsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">y_padding</span><span class="o">=</span><span class="mf">1.7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">compositions</span><span class="p">(</span><span class="n">seg_datas</span><span class="p">[</span><span class="s1">&#39;TonT&#39;</span><span class="p">],</span> <span class="s1">&#39;ClusterName&#39;</span><span class="p">,</span> <span class="s1">&#39;tacco&#39;</span><span class="p">,</span>  <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">reads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>              <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;reference composition&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;TACCO annotation&#39;</span><span class="p">);</span>
<span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">compositions</span><span class="p">(</span><span class="n">seg_datas</span><span class="p">[</span><span class="s1">&#39;TonT&#39;</span><span class="p">],</span> <span class="s1">&#39;baysor&#39;</span><span class="p">,</span>      <span class="s1">&#39;tacco&#39;</span><span class="p">,</span>  <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">reads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Baysor composition&#39;</span><span class="p">);</span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;TACCO annotation&#39;</span><span class="p">);</span>
<span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">compositions</span><span class="p">(</span><span class="n">seg_datas</span><span class="p">[</span><span class="s1">&#39;TonT&#39;</span><span class="p">],</span> <span class="s1">&#39;ssam&#39;</span><span class="p">,</span>        <span class="s1">&#39;tacco&#39;</span><span class="p">,</span>  <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">reads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;SSAM composition&#39;</span><span class="p">);</span>      <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;TACCO annotation&#39;</span><span class="p">);</span>
<span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">compositions</span><span class="p">(</span><span class="n">seg_datas</span><span class="p">[</span><span class="s1">&#39;TonB&#39;</span><span class="p">],</span> <span class="s1">&#39;tacco&#39;</span><span class="p">,</span>       <span class="s1">&#39;baysor&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">reads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;TACCO composition&#39;</span><span class="p">);</span>     <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Baysor annotation&#39;</span><span class="p">);</span>
<span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">compositions</span><span class="p">(</span><span class="n">seg_datas</span><span class="p">[</span><span class="s1">&#39;TonS&#39;</span><span class="p">],</span> <span class="s1">&#39;tacco&#39;</span><span class="p">,</span>       <span class="s1">&#39;ssam&#39;</span><span class="p">,</span>   <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">reads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;TACCO composition&#39;</span><span class="p">);</span>     <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;SSAM annotation&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_25_0.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_25_0.png" />
</div>
</div>
<p>Find spatial layered structure using the TACCO segmented data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">analysis_key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;tacco-tacco&#39;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">co_occurrence</span><span class="p">(</span><span class="n">seg_datas</span><span class="p">[</span><span class="s1">&#39;TonT&#39;</span><span class="p">],</span> <span class="s1">&#39;tacco&#39;</span><span class="p">,</span> <span class="n">delta_distance</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_distance</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">result_key</span><span class="o">=</span><span class="n">analysis_key</span><span class="p">);</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">co_occurrence</span><span class="p">(</span><span class="n">seg_datas</span><span class="p">[</span><span class="s1">&#39;TonT&#39;</span><span class="p">],</span> <span class="n">analysis_key</span><span class="p">,</span> <span class="n">score_key</span><span class="o">=</span><span class="s1">&#39;composition&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">show_only_center</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Hippocampus&#39;</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axsize</span><span class="o">=</span><span class="p">(</span><span class="mf">2.6</span><span class="p">,</span><span class="mf">1.7</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
<span class="c1"># annotate selected peaks in the data</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">selection</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;anno&#39;</span><span class="p">:[</span><span class="s1">&#39;Hippocampus&#39;</span><span class="p">,</span><span class="s1">&#39;Oligodendrocyte Mature&#39;</span><span class="p">,</span><span class="s1">&#39;Pyramidal L2-3&#39;</span><span class="p">,</span><span class="s1">&#39;Pyramidal L2-3 L5&#39;</span><span class="p">,</span><span class="s1">&#39;Pyramidal L3-4&#39;</span><span class="p">,</span><span class="s1">&#39;pyramidal L4&#39;</span><span class="p">,</span><span class="s1">&#39;Pyramidal L6&#39;</span><span class="p">]})</span>
<span class="n">all_annotations</span> <span class="o">=</span> <span class="n">seg_datas</span><span class="p">[</span><span class="s1">&#39;TonT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="n">analysis_key</span><span class="p">][</span><span class="s1">&#39;annotation&#39;</span><span class="p">]</span>
<span class="n">selection</span><span class="p">[</span><span class="s1">&#39;anno_idx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selection</span><span class="p">[</span><span class="s1">&#39;anno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">all_annotations</span> <span class="o">==</span> <span class="n">x</span><span class="p">))</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()</span>
<span class="n">selection</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selection</span><span class="p">[</span><span class="s1">&#39;anno_idx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">())])</span>
<span class="n">selection</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selection</span><span class="p">[</span><span class="s1">&#39;anno_idx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">())])</span>
<span class="n">selection</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selection</span><span class="o">.</span><span class="n">itertuples</span><span class="p">()):</span>
    <span class="n">arrowprops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span><span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc&quot;</span><span class="p">,</span> <span class="n">relpos</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">anno</span><span class="p">,</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-small&#39;</span><span class="p">,</span>
            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="mi">200</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">),</span> <span class="n">selection</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="mf">0.21</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">)),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
            <span class="n">arrowprops</span><span class="o">=</span><span class="n">arrowprops</span><span class="p">,</span>
            <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TACCO&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;$p(anno|center)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Distance from Hippocampus (µm)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
co_occurrence: The argument `distance_key` is `None`, meaning that the distance which is now calculated on the fly will not be saved. Providing a precalculated distance saves time in multiple calls to this function.
calculating distance for sample 1/1
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0, &#39;Distance from Hippocampus (µm)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_27_2.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_27_2.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">reference</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;um_per_pixel&#39;</span><span class="p">]</span>
<span class="n">reference</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">reference</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;um_per_pixel&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">method</span><span class="p">,</span><span class="n">seg</span><span class="p">,</span><span class="n">nice_ann</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ext_seg_props</span><span class="p">[</span><span class="s1">&#39;ann_col&#39;</span><span class="p">],</span><span class="n">ext_seg_props</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">ext_seg_props</span><span class="p">[</span><span class="s1">&#39;nice_ann&#39;</span><span class="p">]):</span>
    <span class="n">analysis_key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">-Hippocampus&#39;</span>
    <span class="n">filtered</span> <span class="o">=</span> <span class="n">seg_datas</span><span class="p">[</span><span class="n">seg</span><span class="p">][</span><span class="n">tc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">seg_datas</span><span class="p">[</span><span class="n">seg</span><span class="p">]</span><span class="o">.</span><span class="n">X</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">segmented_min_counts</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">tc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">co_occurrence</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">center_key</span><span class="o">=</span><span class="s1">&#39;ClusterName&#39;</span><span class="p">,</span> <span class="n">delta_distance</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_distance</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">result_key</span><span class="o">=</span><span class="n">analysis_key</span><span class="p">);</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">co_occurrence</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">analysis_key</span><span class="p">,</span> <span class="n">score_key</span><span class="o">=</span><span class="s1">&#39;composition&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">show_only_center</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Hippocampus&#39;</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axsize</span><span class="o">=</span><span class="p">(</span><span class="mf">2.6</span><span class="p">,</span><span class="mf">1.7</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">0.48</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">nice_ann</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;$p(anno|center)$&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Distance from Hippocampus (µm)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
co_occurrence: The argument `distance_key` is `None`, meaning that the distance which is now calculated on the fly will not be saved. Providing a precalculated distance saves time in multiple calls to this function.
calculating distance for sample 1/1
co_occurrence: The argument `distance_key` is `None`, meaning that the distance which is now calculated on the fly will not be saved. Providing a precalculated distance saves time in multiple calls to this function.
calculating distance for sample 1/1
co_occurrence: The argument `distance_key` is `None`, meaning that the distance which is now calculated on the fly will not be saved. Providing a precalculated distance saves time in multiple calls to this function.
calculating distance for sample 1/1
co_occurrence: The argument `distance_key` is `None`, meaning that the distance which is now calculated on the fly will not be saved. Providing a precalculated distance saves time in multiple calls to this function.
calculating distance for sample 1/1
co_occurrence: The argument `distance_key` is `None`, meaning that the distance which is now calculated on the fly will not be saved. Providing a precalculated distance saves time in multiple calls to this function.
calculating distance for sample 1/1
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_29_1.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_29_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_29_2.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_29_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_29_3.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_29_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_29_4.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_29_4.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_29_5.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_29_5.png" />
</div>
</div>
</section>
<section id="Get-an-impression-of-the-stability-of-TACCO's-single-molecule-annotation-wrt-changes-in-its-configuration">
<h2>Get an impression of the stability of TACCO’s single molecule annotation wrt changes in its configuration<a class="headerlink" href="#Get-an-impression-of-the-stability-of-TACCO's-single-molecule-annotation-wrt-changes-in-its-configuration" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod_props</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">[</span> <span class="s1">&#39;tacco&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_pla0&#39;</span><span class="p">,</span> <span class="s1">&#39;pla0&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ platform normalization&#39;</span><span class="p">,</span> <span class="s1">&#39;platform normalization&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_bisWO&#39;</span><span class="p">,</span> <span class="s1">&#39;bisWO&#39;</span><span class="p">,</span> <span class="s1">&#39;w/o bisection&#39;</span><span class="p">,</span> <span class="s1">&#39;bisection&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_bis22&#39;</span><span class="p">,</span> <span class="s1">&#39;bis22&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ bisection(2,2)&#39;</span><span class="p">,</span> <span class="s1">&#39;bisection&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_bis24&#39;</span><span class="p">,</span> <span class="s1">&#39;bis24&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ bisection(2,4)&#39;</span><span class="p">,</span> <span class="s1">&#39;bisection&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_bis82&#39;</span><span class="p">,</span> <span class="s1">&#39;bis82&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ bisection(8,2)&#39;</span><span class="p">,</span> <span class="s1">&#39;bisection&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_bis84&#39;</span><span class="p">,</span> <span class="s1">&#39;bis84&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ bisection(8,4)&#39;</span><span class="p">,</span> <span class="s1">&#39;bisection&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_mul5&#39;</span><span class="p">,</span> <span class="s1">&#39;mul5&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ multi_center(5)&#39;</span><span class="p">,</span> <span class="s1">&#39;multi_center&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_mul10&#39;</span><span class="p">,</span> <span class="s1">&#39;mul10&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ multi_center(10)&#39;</span><span class="p">,</span> <span class="s1">&#39;multi_center&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_mul20&#39;</span><span class="p">,</span> <span class="s1">&#39;mul20&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ multi_center(20)&#39;</span><span class="p">,</span> <span class="s1">&#39;multi_center&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_eps05&#39;</span><span class="p">,</span> <span class="s1">&#39;eps05&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ epsilon(0.5)&#39;</span><span class="p">,</span> <span class="s1">&#39;epsilon&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_eps005&#39;</span><span class="p">,</span> <span class="s1">&#39;eps005&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ epsilon(0.05)&#39;</span><span class="p">,</span> <span class="s1">&#39;epsilon&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_lam1&#39;</span><span class="p">,</span> <span class="s1">&#39;lam1&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ lambda(1.0)&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_lam001&#39;</span><span class="p">,</span> <span class="s1">&#39;lam001&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ lambda(0.01)&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_bin5&#39;</span><span class="p">,</span> <span class="s1">&#39;bin5&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ bin_size(5)&#39;</span><span class="p">,</span> <span class="s1">&#39;bin_size&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_bin20&#39;</span><span class="p">,</span> <span class="s1">&#39;bin20&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ bin_size(20)&#39;</span><span class="p">,</span> <span class="s1">&#39;bin_size&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_nsh2&#39;</span><span class="p">,</span> <span class="s1">&#39;nsh2&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ n_shifts(2)&#39;</span><span class="p">,</span> <span class="s1">&#39;n_shifts&#39;</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;tacco_nsh4&#39;</span><span class="p">,</span> <span class="s1">&#39;nsh4&#39;</span><span class="p">,</span> <span class="s1">&#39;w/ n_shifts(4)&#39;</span><span class="p">,</span> <span class="s1">&#39;n_shifts&#39;</span><span class="p">,</span> <span class="p">],</span>
<span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span><span class="s1">&#39;mod&#39;</span><span class="p">,</span><span class="s1">&#39;nice&#39;</span><span class="p">,</span><span class="s1">&#39;group&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>

<span class="n">comps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">mod_props</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mod_props</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">comps</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">rna_coords</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">rna_coords</span><span class="p">[</span><span class="n">key2</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">mod_props</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

<span class="n">sub</span> <span class="o">=</span> <span class="n">rna_coords</span><span class="p">[</span><span class="n">rna_coords</span><span class="p">[</span><span class="s1">&#39;ClusterName&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="p">{</span><span class="n">key2</span><span class="p">:</span> <span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ClusterName&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sub</span><span class="p">[</span><span class="n">key2</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">mod_props</span><span class="o">.</span><span class="n">index</span><span class="p">}</span>

<span class="n">plot_df</span> <span class="o">=</span> <span class="n">comps</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tacco&#39;</span><span class="p">:</span><span class="s1">&#39;annotation stability&#39;</span><span class="p">})</span>
<span class="n">plot_df</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mod_props</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">])</span>
<span class="n">plot_df</span><span class="p">[</span><span class="s1">&#39;consistency with osmFISH annotation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
<span class="n">plot_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">comps</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mod_props</span><span class="p">[</span><span class="s1">&#39;nice&#39;</span><span class="p">])</span>
<span class="n">plot_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;modification&#39;</span>
<span class="n">plot_df</span> <span class="o">=</span> <span class="n">plot_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span><span class="n">axs</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">axsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y_padding</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;modification&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;consistency with osmFISH annotation&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="kc">None</span><span class="p">);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;modification&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;annotation stability&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="p">);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_osmFISH_single_molecule_annotation_31_0.png" src="../_images/notebooks_osmFISH_single_molecule_annotation_31_0.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="object_splitting.html" class="btn btn-neutral float-left" title="Object splitting for in-silico mixed scRNA-seq data and Slide-Seq data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="overview.html" class="btn btn-neutral float-right" title="TACCO overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Broad Institute.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>